
error_log  /home/nvidia/workspace/Security_Robot_AI/nginx_error.log;
load_module /usr/lib/nginx/modules/ngx_rtmp_module.so;

worker_processes  2;

events {
    worker_connections  8192;
}

rtmp {
    server {
        listen 1935 ;# listen port, change if occupied
        chunk_size 512 ;# 進一步降低 chunk size 以減少延遲
        application live {  # create an application named live
             live on    ;# enable live application
             gop_cache on;              # 啟用 GOP 快取，拉流時只送最新一個 GOP，降低啟動延遲
             drop_idle_publisher 2s;    # 降低到 2 秒無推流自動斷線（進一步減少）
             idle_streams off;          # 無人拉流時自動丟棄積壓資料，防止緩衝堆積
             sync 1ms;                  # 同步延遲設定（從5ms降低到1ms）
             wait_key on;               # 等待關鍵幀
             wait_video on;             # 等待視頻幀
             publish_notify on;         # 推流通知
             play_restart on;           # 播放重啟
             # 新增極低延遲設定
             interleave on;             # 啟用交錯模式
             buffer 50ms;               # 設定緩衝區為50ms（從100ms減少）
             max_connections 10;        # 限制連接數
             allow publish 127.0.0.1    ;#
             allow publish 192.168.1.0/24 ;# 允許區網內相機推流
             allow play all ;
        }
    }
}

http {
    include       mime.types;
    default_type  application/octet-stream;

    error_log  /home/nvidia/workspace/Security_Robot_AI/nginx_error.log;
    access_log /home/nvidia/workspace/Security_Robot_AI/nginx_access.log;

    sendfile        off;
    #tcp_nopush     on;

    server_names_hash_bucket_size 128;

    ## Start: Timeouts ##
    client_body_timeout   10;
    client_header_timeout 10;
    keepalive_timeout     30;
    send_timeout          10;
    keepalive_requests    10;
    ## End: Timeouts ##

    server {
        listen       80;
        server_name  localhost;

        location / {
            root   html;
            index  index.html index.htm;
        }
    }
}